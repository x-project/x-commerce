<link rel="import" href="/components/app-routes/app-routes.html">
<link rel="import" href="/components/app-route/app-route.html">
<link rel="import" href="/components/app-container/app-container.html">
<link rel="import" href="/components/app-link/app-link.html">
<link rel="import" href="/components/app-session/app-session.html">
<link rel="import" href="/components/api-model-get/api-model-get.html">
<link rel="import" href="/components/api-model-find/api-model-find.html">
<link rel="import" href="/elements/router-behaviour/router-behaviour.html">
<link rel="import" href="../app-theme/app-theme.html">
<link rel="import" href="../page-home/page-home.html">
<link rel="import" href="../page-collections/page-collections.html">
<link rel="import" href="../page-collection/page-collection.html">
<link rel="import" href="../page-orders/page-orders.html">
<link rel="import" href="../page-order/page-order.html">
<link rel="import" href="../page-products/page-products.html">
<link rel="import" href="../page-product/page-product.html">
<link rel="import" href="../page-customers/page-customers.html">
<link rel="import" href="../page-customer/page-customer.html">
<link rel="import" href="../page-store/page-store.html">
<link rel="import" href="../page-variants/page-variants.html">
<link rel="import" href="../page-variant/page-variant.html">
<link rel="import" href="../page-invite/page-invite.html">
<link rel="import" href="../page-login/page-login.html">
<link rel="import" href="../page-member/page-member.html">
<link rel="import" href="../page-signup/page-signup.html">
<link rel="import" href="../page-team/page-team.html">
<link rel="import" href="../page-vendor/page-vendor.html">
<link rel="import" href="../page-vendors/page-vendors.html">
<link rel="import" href="../page-test/page-test.html">
<dom-module id="app-boot">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <app-container id="app" on-login="on_login" on-logout="on_logout"></app-container>

  </template>
</dom-module>
<script>

  Polymer({

    is: 'app-boot',

    properties: {
      user: {
        type: Object
      }
    },

    behaviors: [
      Polymer.RouterBehaviour
    ],

    on_login: function (event) {
      this.$.session.set('token', event.detail.id);
      this.$.session.set('user', event.detail.user);
      page('/admin');
    },

    on_logout: function (event) {
      this.$.session.unset('token');
      this.$.session.unset('user');
    },

    auth: function (context) {
      return true; //context.token;
    },

    '/admin': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-home';
      this.open_page(context);
    },

    '/admin/store': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }

      this.find_models({
          collection: 'stores',
          one: true
        });
        .then(function (model) {
          context.page_name = 'page-store';
          context.data.store = model;
          this.open_page(context);
        }.bind(this))
        .catch(function (error) {
          context.page_name = 'page-404';
          context.data.error = error;
        });
    },

    '/admin/collections': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-collections';
      this.open_page(context);
    },

    '/admin/collections/new': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-collection';
      context.data = { collection: {} };
      this.open_page(context);
    },

    '/admin/collections/:collection_id': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }

      this.get_model({
          collection: 'collections',
          modelId: context.params.collection_id,
          include: ['products', 'images']
        })
        .then(function (model) {
          context.page_name = 'page-collection';
          context.data.collection = model;
          this.open_page(context);
        }.bind(this))
        .catch(function (error) {
          context.page_name = 'page-404';
          context.data.error = error;
        });
    },

    '/admin/customers': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-customers';
      this.open_page(context);
    },

    '/admin/customers/new': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-customer';
      context.data = { customer: {} };
      this.open_page(context);
    },

    '/admin/customers/:customer_id': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }

      this.get_model({
          collection: 'customers',
          modelId: context.params.customer_id
        })
        .then(function (model) {
          context.data.customer = model;
          context.page_name = 'page-customer';
          this.open_page(context);
        }.bind(this))
        .catch(function (error) {
          context.data.error = error;
          context.page_name = 'page-404';
          this.open_page(context);
        }.bind(this));
    },

    '/admin/invites/new': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-invite';
      this.open_page(context);
    },

    '/admin/login': function (context) {
      this.init(context);
      if (this.auth(context)) {
        page('/admin');
        return;
      }
      context.page_name = 'page-login';
      this.open_page(context);
    },

    '/admin/members/:member_id': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-member';
      this.open_page(context);
    },

    '/admin/products': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-products';
      this.open_page(context);
    },

    '/admin/products/new': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-product';
      context.data = { product: {} };
      this.open_page(context);
    },

    '/admin/products/:product_id': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }

      this.get_model({
          collection: 'products',
          modelId: context.params.product_id,
          include: ['collections', 'product_type', 'vendor', 'images']
        })
        .then(function (model) {
          context.page_name = 'page-product';
          context.data.product = model;
          this.open_page(context);
        }.bind(this))
        .catch(function (error) {
          context.page_name = 'page-404';
          context.data.error = error;
          this.open_page(context);
        }.bind(this))
    },

    '/admin/products/:product_id/variants': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }

      this.get_model({
          collection: 'products',
          modelId: context.params.product_id,
          include: ['options', 'variants']
        })
        .then(function (model) {
          context.page_name = 'page-variants';
          context.data.product = model;
          this.open_page(context);
        }.bind(this))
        .catch(function (error) {
          context.page_name = 'page-404';
          context.data.error = error;
          this.open_page(context);
        }.bind(this));
    },

    '/admin/products/:product_id/variants/:variant_id': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }

      this.get_model({
          collection: 'product_variants',
            modelId: context.params.variant_id,
          include: ['product']
        })
        .then(function (model) {
          context.page_name = 'page-variant';
          context.data.variant = model;
          this.open_page(context);
        }.bind(this))
        .catch(function (error) {
          context.page_name = 'page-404';
          context.data.error = error;
          this.open_page(context);
        }.bind(this));
    },

    '/admin/orders': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-orders';
      this.open_page(context);
    },

    '/admin/orders/new': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-order';
      context.data = { order: {} };
      this.open_page(context);
    },

    '/admin/orders/:order_id': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }

      this.get_model({
          collection: 'orders',
          modelId: context.params.order_id,
          include: [{'order_items': ['product','product_variant']}, 'customer']
        })
        .then(function (model) {
          context.page_name = 'page-order';
          context.data.order = model;
          this.open_page(context);
        }.bind(this))
        .catch(function (error) {
          context.page_name = 'page-404';
          context.data.error = error;
          this.open_page(context);
        }.bind(this));
    },

    '/admin/signup': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-signup';
      this.open_page(context);
    },

    '/admin/team': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-team';
      this.open_page(context);
    },

    '/admin/test': function (context) {
      this.init(context);
      context.page_name = 'page-test';
      this.open_page(context);
    },

    '/admin/vendors': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-vendors';
      this.open_page(context);
    },

    '/admin/vendors/new': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }
      context.page_name = 'page-vendor';
      context.data = { vendor: {} };
      this.open_page(context);
    },

    '/admin/vendors/:vendor_id': function (context) {
      this.init(context);
      if (!this.auth(context)) {
        page('/admin/login');
        return;
      }

      this.get_model({
          collection: 'vendors',
          modelId: context.params.vendor_id
        })
        .then(function (model) {
          context.page_name = 'page-vendor';
          context.data.vendor = model;
          this.open_page(context);
        }.bind(this))
        .catch(function (error) {
          context.page_name = 'page-404';
          context.data.error = error;
          this.open_page(context);
        }.bind(this));
    }

  });
</script>