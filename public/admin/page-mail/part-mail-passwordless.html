<link rel="import" href="../../components/app-session/app-session.html">
<link rel="import" href="../field-long-text/field-long-text.html">
<link rel="import" href="../field-text/field-text.html">
<dom-module id="part-mail-passwordless">
  <template>
    <style include="style-button"></style>

    <div class="panel">
      <h3>Passwordless content</h3>
      <field-long-text label="Message in HTML" property="text" value="{{message.text}}"
        error="{{error}}">
      </field-long-text>
      <button class="btn btn-secondary" on-click="on_submit">Submit</button>
    </div>

  </template>
</dom-module>

<script>
  Polymer({

    is: 'part-mail-passwordless',

    properties: {
      messages: {
        type: Array,
        value: function () { return []; },
        observer: '_on_change_messages'
      },
      message: {
        type: Object,
        value: function () { return {}; }
      }
    },

    _on_change_messages: function () {
      if (!this.messages) {
        return;
      }
      var message = {};
      this.messages.find(function (item) {
        if (item.type == "passworless_via_email") {
          this.message =  item;
          return true;
        }
      }, this);
    },

    on_submit: function (event) {
      event.stopPropagation();
      var data = {
        type: 'passworless_via_email',
        text: this.message.text
      };
      if (!this.message.id)Â {
        this.fire('try-create', data);
        return;
      }
      data.id = this.message.id;
      this.fire('try-update', data);
    }

  });
</script>