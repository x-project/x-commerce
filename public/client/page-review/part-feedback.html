<link rel="import" href="/components/api-model/api-model.html">
<link rel="import" href="form-feedback.html">
<dom-module id="part-feedback">
  <template>

    <api-model-update id="update" collection="reviews" data="{{review}}"
      model-id="{{review.id}}" on-response="on_response">
    </api-model-update>

    <form-feedback id="form_feedback" review="{{review}}" on-try-save="on_try_save">
    </form-feedback>

  </template>
</dom-module>

<script src="../../scripts/fetch/fetch.js"></script>

<script>
  Polymer({

    is: 'part-feedback',

    properties: {
      review: {
        type: Object,
        notify: true,
        value: function () { return {}; }
      }
    },

    on_try_save: function  (event) {
      event.stopPropagation();
      this.review.closed = true;
      this.$.update.send();
    },

    on_response: function (event) {
      event.stopPropagation();
      this.$.form_feedback.feedback_completed();
      page('/reviews');
    },

    on_try_save: function () {
      this.review.closed = true;
      Model.create('/api/products', this.product)
        .then(function (data) {
          this.product = data;
          this.response_create();
        }.bind(this))
        .catch(function (error) {
          this.error = error;
        }.bind(this));
    },


  });
</script>